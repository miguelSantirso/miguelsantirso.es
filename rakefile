$host = 'pncil.com'
$username = 'miguelsantirso'
$remote_path = 'miguelsantirso.es'

desc "Publishes the site!"
task :publish do
    require 'net/ssh'
    require 'highline/import'
    
    password = ask("Enter password for host '#{$host}':") { |q| q.echo = "x" }
    
    Net::SSH.start(
        $host, 
        $username,
        :password => password, 
        :auth_methods => ['password'],
        :compression => 'zlib') do |ssh|
        
        ## Net::SSH performs every exec! in a separate shell so we need to do it all at once
        cmd_1 = "cd #{$remote_path}"
        cmd_2 = "git checkout master"
        cmd_3 = "git clean -d -x -f"
        cmd_4 = "git pull"
        ssh.exec! "#{cmd_1} && #{cmd_2} && #{cmd_3} && #{cmd_4}"
    
    end # Net::SSH.start

    puts "... done";
    
end


desc "Installs the required gems"
task :first_time do
    sh 'gem install rakefile'
    sh 'gem install net-ssh'
end